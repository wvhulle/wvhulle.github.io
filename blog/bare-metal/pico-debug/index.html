<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width">
    <meta charset="UTF-8">

    <link rel="icon" type="image/x-icon" href="/logo.png">


    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&family=Fira+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/styles.css">

    

<!-- Comments with GitHub discussions -->
<script src="https://giscus.app/client.js" data-repo="wvhulle/wvhulle.github.io" data-repo-id="R_kgDOGmD5MA"
    data-category="Comments" data-category-id="DIC_kwDOGmD5MM4Cpsng" data-mapping="title" data-strict="1"
    data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light_high_contrast"
    data-lang="en" data-loading="lazy" crossorigin="anonymous" async>
    </script>
<title>


    
    Pico 2 as debugprobe
    



</title>



    
    <link rel="alternate" type="application/atom+xml" title="Willem Vanhulle's blog"
        href="https://willemvanhulle.tech/atom.xml">
    
</head>

<body>
    <aside id="sidebar">

        <a href="/">
            <img src="/logo.png">
        </a>

        <ul id="navigation_links">
            <li id="home-button">
                <a href="/">
                    About
                </a>

            </li>

            
            <li class="section_block">
                <a href="/blog">Blog</a>
                <ul class="section_page_list">
                    
                    
                    
                    
                    <li class="section_page_link">
                        <a href="https:&#x2F;&#x2F;willemvanhulle.tech&#x2F;blog&#x2F;bare-metal&#x2F;">Embedded</a>
                    </li>
                    
                    
                    
                    <li class="section_page_link">
                        <a href="https:&#x2F;&#x2F;willemvanhulle.tech&#x2F;blog&#x2F;linux&#x2F;">Linux</a>
                    </li>
                    
                    
                    
                    <li class="section_page_link">
                        <a href="https:&#x2F;&#x2F;willemvanhulle.tech&#x2F;blog&#x2F;streams&#x2F;">Streams</a>
                    </li>
                    
                    
                    

                    
                </ul>

            </li>

        </ul>


        <a href="" id="back-to-top">
            ↑ </a>

    </aside>



    <main>

        
<article>

    <header>


        <h1 class="title">
            Pico 2 as debugprobe
        </h1>



        <ul class="tags"><li><a href="https://willemvanhulle.tech/tags/raspberry-pi/">Raspberry Pi</a></li><li><a href="https://willemvanhulle.tech/tags/pico/">Pico</a></li><li><a href="https://willemvanhulle.tech/tags/swd/">SWD</a></li><li><a href="https://willemvanhulle.tech/tags/declarative/">declarative</a></li><li><a href="https://willemvanhulle.tech/tags/rust/">Rust</a></li><li><a href="https://willemvanhulle.tech/tags/probe-rs/">probe-rs</a></li><li><a href="https://willemvanhulle.tech/tags/cargo-embed/">cargo-embed</a></li></ul>

        <p class="post_date">Tuesday, 2025-06-03


<a href="#comments">Comments</a>        </p><p class="subtitle">
            How to use the Raspberry Pi Pico 2 as a hardware debugger. <br/>   
        <p>



    </header>


    



    
    <ul class="post_top_headers">
        
        <li>


            
            <a href="https://willemvanhulle.tech/blog/bare-metal/pico-debug/#turning-a-pico-2-into-a-debugger-pico">Turning a Pico 2 into a debugger Pico</a>
            
        </li>
        
        <li>


            
            <a href="https://willemvanhulle.tech/blog/bare-metal/pico-debug/#wire-target-to-debugger">Wire target to debugger</a>
            
        </li>
        
        <li>


            
            <a href="https://willemvanhulle.tech/blog/bare-metal/pico-debug/#configure-flashing-from-laptop">Configure flashing from laptop</a>
            
        </li>
        
    </ul>
    


    <p>On most popular microcontrollers used for educational purposes, there is already some hardware debugging support (also called a <strong>hardware debug probe</strong>) on the board itself, such as on the <a href="https://microbit.org/">Micro:bit</a> or the <a href="https://www.espressif.com/en/products/socs/esp32">ESP32</a>.</p>
<p>Having this debug probe allows you to debug the code running on the target Pico using GDB or other debugging tools.</p>
<p>A debug probe comes in the form of a small secondary chip that can be used to debug the main microcontroller on the board.</p>
<p>The Pico family of microcontrollers does not have this feature built-in. You have two options for debugging a Pico:</p>
<ul>
<li>It is possible to turn a spare Raspberry Pico into a hardware debugging probe for another Pico.</li>
<li>You buy (or borrow) an official Rasberry Pi hardware debug probe.</li>
<li>You manually force the target into BOOTSELF mode and flash with <code>picotool</code>. In that case, you will not be able to debug as easily (you will need a serial monitor).</li>
</ul>
<p>In this workshop, we will pursue the first option. If you get stuck, feel free to ask for a pre-made hardware debugger.</p>
<h3 id="turning-a-pico-2-into-a-debugger-pico"><a class="zola-anchor" href="#turning-a-pico-2-into-a-debugger-pico" aria-label="Anchor link for: turning-a-pico-2-into-a-debugger-pico">Turning a Pico 2 into a debugger Pico</a></h3>
<p>The Raspberry Pi Foundation provides images for Picos that can be flashed to turn a Pico into a hardware debugger.</p>
<ol>
<li>Download the latest <code>debugprobe_on_pico.uf2</code> flash image from the official <a href="https://github.com/raspberrypi/debugprobe/releases"><code>debugprobe</code></a>releases.</li>
<li>Attach the Pico to your laptop while holding the white BOOTSEL button. A mass storage device will appear in your file manager. It will be called something like <code>RP2350</code>.</li>
<li>Drop the downloaded <code>.uf2</code> file onto the mass storage drive emulated by the Pico. Wait for a fraction of a second while the Pico unmounts and reboots as a fresh <code>debugprobe</code>.</li>
</ol>
<p>Now you have successfully made a cheap hardware debugging probe.</p>
<h3 id="wire-target-to-debugger"><a class="zola-anchor" href="#wire-target-to-debugger" aria-label="Anchor link for: wire-target-to-debugger">Wire target to debugger</a></h3>
<p>Let’s make some aliases:</p>
<ul>
<li>Assume <strong>D</strong> is the homemade debug probe (a Pico).</li>
<li>Assume <strong>T</strong> is the target Pico.</li>
</ul>
<p>Right now, there is no cabling between the debug probe and the target Pico. The cables should be connected such that <strong>D</strong> can detect <strong>T</strong> over the SWD debugging protocol.</p>
<p><em><strong>Important</strong>: For this step, you need to have a JST-SH cable. You can find them on <a href="https://www.kiwi-electronics.com/en/jst-sh-1mm-pitch-3-pin-to-male-headers-cable-100mm-long-19930">Kiwi</a>, but they can be hard to find.</em></p>
<ol>
<li>
<p>Plug the white connector of the JST cable into the SWD socket of <strong>D</strong>.</p>
</li>
<li>
<p>Place <strong>T</strong> and <strong>D</strong> in parallel with their USB ports facing upwards (to prevent confusion).</p>
</li>
<li>
<p>Connect the male jumper pins. The three male header pins from <strong>T</strong>’s JST cable should be connected to <strong>D</strong> as follows:</p>
<ul>
<li><strong>T</strong> left (yellow) &lt;-&gt; <strong>D</strong> pin 5</li>
<li><strong>T</strong> middle (black) &lt;-&gt; <strong>D</strong> pin 3</li>
<li><strong>T</strong> right (orange) &lt;-&gt; <strong>D</strong> pin 4</li>
</ul>
<p>Instead of pin numbers, you can also use the pin names:</p>
<ul>
<li><strong>T</strong> SWCLK &lt;-&gt; <strong>D</strong> GP3</li>
<li><strong>T</strong> SWDIO &lt;-&gt; <strong>D</strong> GP2</li>
<li><strong>T</strong> GND &lt;-&gt; <strong>D</strong> GND</li>
</ul>
</li>
<li>
<p>Provide power to <strong>T</strong> using a single USB cable by forwarding power from <strong>D</strong>:</p>
<ul>
<li><strong>T</strong> GND pin 38 &lt;-&gt; <strong>D</strong> pin 38 (Connect ground)</li>
<li><strong>T</strong> VSYS pin 39 &lt;-&gt; <strong>D</strong> pin 39 (Connect power supply)</li>
</ul>
</li>
</ol>
<p><em>Remark: You can also connect <strong>T</strong> to <strong>D</strong> for UART communication. However, I have not needed it so far.</em></p>
<h3 id="configure-flashing-from-laptop"><a class="zola-anchor" href="#configure-flashing-from-laptop" aria-label="Anchor link for: configure-flashing-from-laptop">Configure flashing from laptop</a></h3>
<p>There is still one step remaining: we have to configure our laptop’s development environment to enable flashing (this applies to any microcontroller with an onboard or external debugger).</p>
<ol>
<li>
<p>Install <code>cargo-embed</code>, which is included in the <code>probe-rs</code> tool suite.</p>
<pre data-lang="bash" style="background-color:#f9f9f9;color:#111111;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#c82728;">cargo</span><span style="color:#4271ae;"> install probe-rs-tools
</span></code></pre>
</li>
<li>
<p>Verify that <code>cargo-embed</code> is available in your shell’s <code>PATH</code> (<code>cargo-[CMD]</code> can be called with <code>cargo [CMD]</code>):</p>
<pre data-lang="bash" style="background-color:#f9f9f9;color:#111111;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#c82728;">cargo</span><span style="color:#4271ae;"> embed</span><span style="color:#f07219;"> --version
</span></code></pre>
</li>
<li>
<p>Add <code>udev</code> rules for <code>probe-rs</code> as described in the <a href="https://probe.rs/docs/getting-started/probe-setup/">probe-rs documentation</a>.</p>
<pre data-lang="bash" style="background-color:#f9f9f9;color:#111111;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#c82728;">sudo</span><span style="color:#4271ae;"> curl</span><span style="color:#f07219;"> --output</span><span style="color:#4271ae;"> /etc/udev/rules.d/69-probe-rs.rules </span><span style="color:#839c00;">&quot;https://probe.rs/files/69-probe-rs.rules&quot;
</span><span style="color:#c82728;">sudo</span><span style="color:#4271ae;"> udevadm control</span><span style="color:#f07219;"> --reload-rules
</span><span style="color:#c82728;">sudo</span><span style="color:#4271ae;"> udevadm trigger
</span></code></pre>
</li>
</ol>
<p>Now you can flash changes in the source code directly to the target Pico (without re-plugging it or holding the BOOTSEL button). The debug probe Pico will function as an intermediary between your laptop and the target Pico.</p>
<pre data-lang="bash" style="background-color:#f9f9f9;color:#111111;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#c82728;">cargo</span><span style="color:#4271ae;"> run
</span></code></pre>
<p>You should see two progress bars running to completion in your terminal. As soon as the flash process is finished:</p>
<ul>
<li><strong>T</strong> will start running the new code.</li>
<li>A debug server will be started on <strong>D</strong> so that you can step through your code while it runs on <strong>T</strong>.</li>
</ul>
<p>While the Pico has a generous amount of flash memory, Embassy-produced binaries can sometimes be large. For microcontrollers with less memory, the <a href="https://github.com/johnthagen/min-sized-rust">Min-sized Rust</a> guide provides tips for reducing binary size.</p>



    <section id="comments" class="giscus"></section>


</article>



<footer>



    

    
    <span>
        <a href="https://willemvanhulle.tech/blog/bare-metal/embassy-example/">Introduction to Embassy</a> → </span>


    
</footer>



    </main>



</body>

</html>